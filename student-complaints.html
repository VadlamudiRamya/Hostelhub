<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complaints - HostelHub</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <aside class="sidebar"></aside>
    <main class="main-wrapper">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="fw-bold mb-0">My Complaints</h2>
            <button class="btn btn-premium" data-bs-toggle="modal" data-bs-target="#complaintModal">
                <i class="bi bi-plus-lg me-2"></i> File New Complaint
            </button>
        </div>

        <div class="row fade-in">
            <div class="col-12" id="complaints-list">
                <!-- Complaints will be loaded here -->
            </div>
        </div>

        <!-- Complaint Modal -->
        <div class="modal fade" id="complaintModal" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content border-0 shadow" style="border-radius: var(--radius);">
                    <div class="modal-header border-0 pb-0">
                        <h5 class="fw-bold">File a New Complaint</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <form id="complaintForm">
                        <div class="modal-body p-4">
                            <div class="mb-3">
                                <label class="form-label">Category</label>
                                <select class="form-select" id="complaint-category" required>
                                    <option value="" disabled selected>Select category...</option>
                                    <option value="Electrical">Electrical</option>
                                    <option value="Plumbing">Plumbing</option>
                                    <option value="Cleaning">Cleaning</option>
                                    <option value="Food">Food</option>
                                    <option value="Internet">Internet</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Detailed Message</label>
                                <textarea class="form-control" id="complaint-message" rows="4" placeholder="Describe your issue..." required></textarea>
                            </div>
                        </div>
                        <div class="modal-footer border-0 pt-0">
                            <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-premium px-4">Submit Complaint</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/data.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const user = getCurrentUser();
            if (!user) { window.location.href = 'login.html'; return; }
            renderSidebar('Complaints', user.role);
            renderTopNav(user.name);
            loadComplaints();

            document.getElementById('complaintForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const category = document.getElementById('complaint-category').value;
                const message = document.getElementById('complaint-message').value;
                
                const complaints = getData('complaints');
                const newComplaint = {
                    id: Date.now(),
                    studentName: user.name,
                    category: category,
                    message: message,
                    status: 'Pending',
                    date: new Date().toISOString().split('T')[0]
                };
                
                complaints.unshift(newComplaint);
                saveData('complaints', complaints);
                
                bootstrap.Modal.getInstance(document.getElementById('complaintModal')).hide();
                document.getElementById('complaintForm').reset();
                loadComplaints();
            });
        });

        function loadComplaints() {
            const user = getCurrentUser();
            const complaints = getData('complaints').filter(c => c.studentName === user.name);
            const list = document.getElementById('complaints-list');
            
            if (complaints.length === 0) {
                list.innerHTML = `
                    <div class="text-center py-5">
                        <i class="bi bi-chat-left-dots text-muted display-1"></i>
                        <p class="mt-3 text-muted">You haven't filed any complaints yet.</p>
                    </div>
                `;
                return;
            }

            list.innerHTML = complaints.map(c => `
                <div class="item-card fade-in ${c.status === 'Resolved' ? 'success-border' : 'urgent-border'}">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="badge badge-custom ${c.status === 'Resolved' ? 'badge-success' : 'badge-warning'} mb-2">
                                ${c.status}
                            </span>
                            <h5 class="fw-bold mb-1">${c.category || 'General'} Issue</h5>
                        </div>
                        <small class="text-muted">${c.date}</small>
                    </div>
                    <p class="text-muted mb-0">${c.message}</p>
                </div>
            `).join('');
        }
    </script>
</body>
</html>
