<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Rooms - HostelHub</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <aside class="sidebar"></aside>
    <main class="main-wrapper">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="fw-bold mb-0">Room Management</h2>
            <button class="btn btn-premium" data-bs-toggle="modal" data-bs-target="#roomModal">
                <i class="bi bi-door-open me-2"></i> Add New Room
            </button>
        </div>

        <div class="row g-4 fade-in" id="rooms-grid">
            <!-- Rooms Loaded Dynamically -->
        </div>

        <!-- Room Modal -->
        <div class="modal fade" id="roomModal" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content border-0 shadow" style="border-radius: var(--radius);">
                    <div class="modal-header border-0 pb-0">
                        <h5 class="fw-bold">Add New Room</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <form id="roomForm">
                        <div class="modal-body p-4">
                            <div class="mb-3">
                                <label class="form-label">Room Number</label>
                                <input type="text" class="form-control" id="r-no" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Room Type</label>
                                <select class="form-select" id="r-type">
                                    <option value="AC">AC</option>
                                    <option value="Non-AC">Non-AC</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Capacity</label>
                                <input type="number" class="form-control" id="r-capacity" min="1" required>
                            </div>
                        </div>
                        <div class="modal-footer border-0 pt-0">
                            <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-premium px-4">Add Room</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/data.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const user = getCurrentUser();
            if (!user || user.role !== 'admin') { window.location.href = 'login.html'; return; }
            renderSidebar('Rooms', 'admin');
            renderTopNav(user.name);
            loadRooms();

            document.getElementById('roomForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const rooms = getData('rooms');
                rooms.push({
                    roomNo: document.getElementById('r-no').value,
                    type: document.getElementById('r-type').value,
                    capacity: parseInt(document.getElementById('r-capacity').value),
                    occupied: 0,
                    status: 'Available'
                });
                saveData('rooms', rooms);
                bootstrap.Modal.getInstance(document.getElementById('roomModal')).hide();
                loadRooms();
            });
        });

        function loadRooms() {
            const rooms = getData('rooms');
            const grid = document.getElementById('rooms-grid');
            
            grid.innerHTML = rooms.map(r => {
                const percent = (r.occupied / r.capacity) * 100;
                const progressClass = percent === 100 ? 'bg-danger' : 'bg-success';
                return `
                    <div class="col-md-4 col-lg-3">
                        <div class="stat-card">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <div class="stat-icon ${r.type === 'AC' ? 'icon-blue' : 'icon-orange'} mb-0">
                                    <i class="bi bi-door-closed"></i>
                                </div>
                                <span class="badge badge-custom ${r.occupied >= r.capacity ? 'badge-danger' : 'badge-success'}">
                                    ${r.occupied >= r.capacity ? 'Full' : 'Available'}
                                </span>
                            </div>
                            <h4 class="fw-bold mb-1">Room ${r.roomNo}</h4>
                            <p class="text-muted small mb-3">${r.type}</p>
                            
                            <div class="d-flex justify-content-between small mb-1">
                                <span>Occupancy</span>
                                <span>${r.occupied}/${r.capacity}</span>
                            </div>
                            <div class="progress mb-0" style="height: 6px; border-radius: 10px;">
                                <div class="progress-bar ${progressClass}" style="width: ${percent}%"></div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
    </script>
</body>
</html>
